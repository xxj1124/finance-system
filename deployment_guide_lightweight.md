# 阿里云轻量应用服务器部署指南 - OpenAnolis（龙蜥版）

## 重要说明

您使用的是**阿里云轻量应用服务器**（而非ECS实例），因此在部署过程中存在一些与标准ECS部署不同的操作。本指南将详细说明这些差异和相应的调整步骤。

## 目录

1. [轻量应用服务器与ECS实例的主要区别](#轻量应用服务器与ecs实例的主要区别)
2. [部署步骤调整](#部署步骤调整)
   2.1 [连接到服务器](#1-连接到服务器)
   2.2 [防火墙配置](#2-防火墙配置)
   2.3 [文件上传](#3-文件上传)
   2.4 [应用部署](#4-应用部署)
3. [特殊注意事项](#特殊注意事项)

---

## 轻量应用服务器与ECS实例的主要区别

| 功能 | 轻量应用服务器 | ECS实例 |
|------|--------------|--------|
| 端口管理 | 防火墙 | 安全组 |
| 远程连接 | 内置Workbench + 第三方工具 | Workbench + 第三方工具 |
| 应用镜像 | 预装常用应用（如WordPress） | 纯净系统镜像 |
| 文件管理 | 内置文件管理工具 | 需第三方工具 |
| 操作复杂度 | 更简单，适合个人/小型应用 | 更灵活，适合企业级应用 |

---

## 部署步骤调整

### 1. 连接到服务器

#### 方法一：使用内置Workbench连接（推荐）

1. 登录阿里云轻量应用服务器控制台
2. 在服务器列表中找到您的实例，点击实例名称进入详情页
3. 在详情页顶部，点击「**远程连接**」按钮
4. 在弹出的菜单中，选择「**Workbench远程连接**」
5. 输入服务器登录密码（创建服务器时设置的密码）
6. 点击「**确定**」，即可进入命令行界面

#### 方法二：使用第三方SSH工具连接

与ECS实例相同，可以使用PuTTY等工具连接。

### 2. 防火墙配置

**轻量应用服务器使用「防火墙」而非「安全组」管理端口。**

1. 在服务器详情页顶部，点击「**防火墙**」选项卡
2. 点击右上角的「**添加规则**」按钮
3. 添加以下三条规则：

   | 端口 | 协议 | 应用类型 | 备注 |
   |------|------|----------|------|
   | 22 | TCP | SSH(22) | SSH连接端口 |
   | 80 | TCP | HTTP(80) | HTTP访问端口 |
   | 5000 | TCP | 自定义 | Flask应用端口 |

4. 确保所有规则的「授权对象」设置为 `0.0.0.0/0`

### 3. 文件上传

#### 方法一：使用内置文件管理工具

1. 在服务器详情页顶部，点击「**文件**」选项卡
2. 点击「**上传文件**」按钮
3. 选择本地的项目文件：`E:\trae项目\finance\`
4. 点击「**上传**」，文件会自动上传到服务器的 `/root` 目录

#### 方法二：使用Workbench上传

1. 连接到Workbench后，点击顶部工具栏的「**文件**」按钮
2. 选择「**上传文件**」
3. 选择本地项目文件，点击「**打开**」上传

### 4. 应用部署

应用部署的核心步骤与ECS实例基本相同，包括：

1. 更新系统：
   ```bash
   dnf update -y
   ```

2. 安装必要软件：
   ```bash
   dnf install -y python3 python3-pip python3-venv sqlite sqlite-devel
   ```

3. 创建项目目录并移动文件：
   ```bash
   mkdir -p /var/www/finance
   cp -r /root/* /var/www/finance/
   ```

4. 配置虚拟环境：
   ```bash
   cd /var/www/finance
   python3 -m venv venv
   source venv/bin/activate
   pip install --upgrade pip
   ```

5. 安装依赖：
   ```bash
   pip install -r requirements.txt
   pip install gunicorn
   ```

6. 修改配置文件：
   ```bash
   vim app/config.py
   ```
   - 将 `DEBUG = True` 改为 `DEBUG = False`

7. 启动应用：
   ```bash
   nohup gunicorn --bind 0.0.0.0:5000 app:app > finance.log 2>&1 &
   ```

---

## 特殊注意事项

### 1. 预装应用处理

您的服务器预装了WordPress应用，这可能会占用80端口。如果您想同时运行WordPress和您的Flask应用，有以下两种方案：

#### 方案一：保留WordPress，使用5000端口访问Flask应用
- 无需额外配置，直接使用 `http://8.138.228.54:5000` 访问您的Flask应用
- WordPress继续使用80端口：`http://8.138.228.54`

#### 方案二：停止WordPress，使用80端口运行Flask应用
1. 停止WordPress服务：
   ```bash
   systemctl stop httpd
   systemctl stop mysqld
   ```

2. 禁用WordPress服务自启动：
   ```bash
   systemctl disable httpd
   systemctl disable mysqld
   ```

3. 修改Flask应用端口为80：
   ```bash
   nohup gunicorn --bind 0.0.0.0:80 app:app > finance.log 2>&1 &
   ```

4. 直接使用 `http://8.138.228.54` 访问您的Flask应用

### 2. 防火墙规则管理

轻量应用服务器的防火墙规则修改后立即生效，无需重新加载。

### 3. 文件管理

轻量应用服务器提供了内置的文件管理工具，您可以在控制台直接管理文件，无需使用SSH命令。

### 4. 监控与维护

轻量应用服务器提供了更直观的监控界面，您可以在控制台直接查看CPU、内存、磁盘和网络使用情况。

---

## 后续支持

如果您在部署过程中遇到任何问题，可以：
1. 查看阿里云轻量应用服务器官方文档：https://help.aliyun.com/product/58958.html
2. 在阿里云控制台提交工单
3. 参考项目根目录下的其他部署指南

祝您部署成功！🎉
