# 阿里云OpenAnolis（龙蜥版）系统部署指南 - 超级详细版

## 目录

1. [准备工作](#准备工作)
   1.1 [本地计算机准备](#11-本地计算机准备)
   1.2 [服务器准备](#12-服务器准备)

2. [连接到阿里云服务器](#连接到阿里云服务器)
   2.1 [使用阿里云控制台Workbench连接（推荐）](#21-使用阿里云控制台workbench连接推荐)

3. [在服务器上安装必要的软件](#在服务器上安装必要的软件)
   3.1 [更新系统](#31-更新系统)
   3.2 [安装Python 3和pip](#32-安装python-3和pip)
   3.3 [安装SQLite数据库](#33-安装sqlite数据库)
   3.4 [安装Git（可选）](#34-安装git可选)

4. [上传项目文件到服务器](#上传项目文件到服务器)
   4.1 [创建项目目录](#41-创建项目目录)
   4.2 [方法一：使用阿里云控制台文件上传（推荐）](#42-方法一使用阿里云控制台文件上传推荐)
   4.3 [方法二：使用压缩包上传](#43-方法二使用压缩包上传)

5. [配置项目](#配置项目)
   5.1 [进入项目目录](#51-进入项目目录)
   5.2 [创建Python虚拟环境](#52-创建python虚拟环境)
   5.3 [激活虚拟环境](#53-激活虚拟环境)
   5.4 [升级pip](#54-升级pip)
   5.5 [安装项目依赖](#55-安装项目依赖)
   5.6 [修改配置文件](#56-修改配置文件)

6. [启动应用](#启动应用)
   6.1 [安装Gunicorn](#61-安装gunicorn)
   6.2 [在后台启动应用](#62-在后台启动应用)
   6.3 [检查应用是否启动成功](#63-检查应用是否启动成功)

7. [配置防火墙](#配置防火墙)
   7.1 [检查防火墙状态](#71-检查防火墙状态)
   7.2 [开放必要端口](#72-开放必要端口)
   7.3 [重新加载防火墙规则](#73-重新加载防火墙规则)
   7.4 [确认端口已开放](#74-确认端口已开放)

8. [测试访问网站](#测试访问网站)
   8.1 [在本地浏览器访问](#81-在本地浏览器访问)
   8.2 [查看应用日志](#82-查看应用日志)

9. [常见问题解决方案](#常见问题解决方案)
   9.1 [无法连接到服务器](#91-无法连接到服务器)
   9.2 [无法上传文件](#92-无法上传文件)
   9.3 [依赖安装失败](#93-依赖安装失败)
   9.4 [应用启动失败](#94-应用启动失败)
   9.5 [无法访问网站](#95-无法访问网站)

---

## 准备工作

### 1.1 本地计算机准备

**执行环境：本地计算机（您的Windows电脑）**

1. 确保您的Windows电脑已连接到互联网
2. 记录以下重要信息：
   - 阿里云服务器公网IP地址：**8.138.228.54**（非常重要！）
   - 服务器登录密码（创建服务器时设置的密码）
3. 确认本地项目文件位置：`E:\trae项目\finance\`

### 1.2 服务器准备

**执行环境：阿里云服务器（通过阿里云控制台操作）**

1. 打开阿里云官网：https://www.aliyun.com/
2. 点击右上角「登录」按钮，使用您的阿里云账号登录
3. 登录成功后，进入「控制台」
4. 在左侧菜单中找到「云服务器ECS」，点击进入
5. 在ECS实例列表中，找到您的服务器（IP：8.138.228.54）
6. 确认服务器状态为「运行中」
7. 点击「管理」按钮，进入服务器详情页
8. 在左侧菜单中找到「安全组」，点击进入
9. 确认已开放以下端口：
   - 22端口（SSH连接用）
   - 80端口（HTTP访问用）
   - 5000端口（应用访问用）

---

## 连接到阿里云服务器

### 2.1 使用阿里云控制台Workbench连接（推荐）

**执行环境：本地计算机（浏览器）**

1. 在ECS实例列表中，找到您的服务器（IP：8.138.228.54）
2. 在「操作」列中，点击「远程连接」下拉菜单
3. 选择「Workbench远程连接」
4. 在弹出的窗口中，输入您的服务器登录密码
5. 点击「确定」按钮
6. 等待几秒钟，连接成功后，您会看到一个黑色的命令行界面
   - 界面顶部会显示「Workbench远程连接」
   - 界面底部会有「#」符号，这是命令提示符

**提示**：如果密码输入错误，会提示「登录失败」，请检查密码后重新输入

---

## 在服务器上安装必要的软件

### 3.1 更新系统

**执行环境：服务器环境（Workbench命令行界面）**

1. 在命令行中输入以下命令，按回车键执行：
   ```bash
   dnf update -y
   ```

2. 等待命令执行完成（可能需要几分钟时间）
   - 会显示大量的更新信息
   - 最后会显示「Complete!」表示更新完成

### 3.2 安装Python 3和pip

**执行环境：服务器环境（Workbench命令行界面）**

1. 在命令行中输入以下命令，按回车键执行：
   ```bash
   dnf install -y python3 python3-pip python3-venv
   ```

2. 等待命令执行完成
   - 会显示安装进度
   - 最后会显示「Complete!」表示安装完成

3. 验证Python是否安装成功，输入以下命令：
   ```bash
   python3 --version
   ```
   - 预期输出：类似 `Python 3.6.8` 或更高版本

4. 验证pip是否安装成功，输入以下命令：
   ```bash
   pip3 --version
   ```
   - 预期输出：类似 `pip 9.0.3 from /usr/lib/python3.6/site-packages (python 3.6)`

### 3.3 安装SQLite数据库

**执行环境：服务器环境（Workbench命令行界面）**

1. 在命令行中输入以下命令，按回车键执行：
   ```bash
   dnf install -y sqlite sqlite-devel
   ```

2. 等待命令执行完成
   - 最后会显示「Complete!」表示安装完成

3. 验证SQLite是否安装成功，输入以下命令：
   ```bash
   sqlite3 --version
   ```
   - 预期输出：类似 `3.26.0 2018-12-01 12:34:55`

### 3.4 安装Git（可选）

**执行环境：服务器环境（Workbench命令行界面）**

如果您需要从Git仓库拉取代码，可以安装Git：

1. 在命令行中输入以下命令，按回车键执行：
   ```bash
   dnf install -y git
   ```

2. 等待命令执行完成

3. 验证Git是否安装成功，输入以下命令：
   ```bash
   git --version
   ```
   - 预期输出：类似 `git version 2.27.0`

---

## 上传项目文件到服务器

### 4.1 创建项目目录

**执行环境：服务器环境（Workbench命令行界面）**

1. 在命令行中输入以下命令，按回车键执行，创建项目目录：
   ```bash
   mkdir -p /var/www/finance
   ```

2. 确认目录已创建，输入以下命令：
   ```bash
   ls -la /var/www/
   ```
   - 预期输出：应该能看到 `finance` 目录

### 4.2 方法一：使用阿里云控制台文件上传（推荐）

**执行环境：本地计算机（浏览器Workbench界面）**

1. 在Workbench远程连接界面的顶部工具栏，找到「文件」按钮
2. 点击「文件」按钮，在下拉菜单中选择「上传文件」
3. 在弹出的「文件上传」窗口中，点击「选择文件」按钮
4. 在打开的文件选择窗口中，导航到本地项目目录：`E:\trae项目\finance\`
5. 按住「Ctrl」键，点击选择所有文件和文件夹（或者按「Ctrl+A」全选）
6. 点击「打开」按钮，开始上传
7. 等待上传完成（根据文件大小可能需要几分钟）
   - 上传完成后，会显示「上传成功」
   - 文件默认上传到服务器的 `/root` 目录

8. **将文件移动到项目目录**（执行环境：服务器环境）
   - 在命令行中输入以下命令，按回车键执行：
     ```bash
     cp -r /root/* /var/www/finance/
     ```

### 4.3 方法二：使用压缩包上传

**执行环境：本地计算机 + 服务器环境**

#### 步骤1：在本地计算机压缩项目文件
1. 打开「我的电脑」，导航到 `E:\trae项目\finance\` 目录
2. 选中整个 `finance` 文件夹
3. 右键点击，选择「发送到」→「压缩(zipped)文件夹」
4. 等待压缩完成，会生成 `finance.zip` 文件

#### 步骤2：上传压缩包到服务器
1. 在Workbench界面，点击顶部「文件」→「上传文件」
2. 选择本地的 `finance.zip` 文件，点击「上传」
3. 等待上传完成

#### 步骤3：在服务器上解压文件
**执行环境：服务器环境**

1. 在命令行中输入以下命令，进入项目目录：
   ```bash
   cd /var/www/
   ```

2. 输入以下命令，解压压缩包：
   ```bash
   unzip /root/finance.zip -d finance/
   ```

3. 输入以下命令，检查文件是否解压成功：
   ```bash
   ls -la /var/www/finance/
   ```
   - 预期输出：应该能看到项目的所有文件和文件夹

---

## 配置项目

### 5.1 进入项目目录

**执行环境：服务器环境**

1. 在命令行中输入以下命令，按回车键执行：
   ```bash
   cd /var/www/finance
   ```

2. 输入以下命令，确认当前目录：
   ```bash
   pwd
   ```
   - 预期输出：`/var/www/finance`

### 5.2 创建Python虚拟环境

**执行环境：服务器环境**

1. 在命令行中输入以下命令，创建虚拟环境：
   ```bash
   python3 -m venv venv
   ```

2. 等待命令执行完成（几秒钟时间）

3. 输入以下命令，确认虚拟环境已创建：
   ```bash
   ls -la
   ```
   - 预期输出：应该能看到 `venv` 目录

### 5.3 激活虚拟环境

**执行环境：服务器环境**

1. 在命令行中输入以下命令，激活虚拟环境：
   ```bash
   source venv/bin/activate
   ```

2. 激活成功后，命令提示符会变成：`(venv) [root@iZ7xv2oxvtpwp6y3cwmb49Z finance]#`
   - 注意前面多了 `(venv)` 标识

### 5.4 升级pip

**执行环境：服务器环境（虚拟环境已激活）**

1. 在命令行中输入以下命令，升级pip：
   ```bash
   pip install --upgrade pip
   ```

2. 等待命令执行完成
   - 会显示升级进度
   - 最后会显示「Successfully installed pip-23.3.1」等信息

### 5.5 安装项目依赖

**执行环境：服务器环境（虚拟环境已激活）**

1. 确认 `requirements.txt` 文件存在，输入以下命令：
   ```bash
   ls -la requirements.txt
   ```
   - 预期输出：显示 `requirements.txt` 文件信息

2. 输入以下命令，安装项目依赖：
   ```bash
   pip install -r requirements.txt
   ```

3. 等待命令执行完成（可能需要几分钟时间）
   - 会显示大量的安装信息
   - 最后会显示「Successfully installed ...」等信息

### 5.6 修改配置文件

**执行环境：服务器环境（虚拟环境已激活）**

1. 在命令行中输入以下命令，使用vim编辑器打开配置文件：
   ```bash
   vim app/config.py
   ```

2. 进入vim编辑器后，按 `i` 键进入「插入模式」
   - 左下角会显示「-- INSERT --」

3. 找到SQLite数据库路径配置行（大约第8行）：
   ```python
   SQLALCHEMY_DATABASE_URI = f'sqlite:///{os.path.join(BASE_DIR, "finance.db")}'
   ```
   - 确保路径正确，如果不是这样，请修改为上述内容

4. 找到DEBUG模式配置行（大约第19行）：
   ```python
   DEBUG = True
   ```
   - 修改为：
     ```python
     DEBUG = False
     ```

5. 按 `Esc` 键退出「插入模式」
6. 输入 `:wq` 并按回车键，保存并退出编辑器
   - `:w` 表示保存
   - `:q` 表示退出

---

## 启动应用

### 6.1 安装Gunicorn

**执行环境：服务器环境（虚拟环境已激活）**

1. 在命令行中输入以下命令，安装Gunicorn：
   ```bash
   pip install gunicorn
   ```

2. 等待安装完成
   - 最后会显示「Successfully installed gunicorn-20.1.0」等信息

### 6.2 在后台启动应用

**执行环境：服务器环境（虚拟环境已激活）**

1. 在命令行中输入以下命令，启动应用：
   ```bash
   nohup gunicorn --bind 0.0.0.0:5000 app:app > finance.log 2>&1 &
   ```

2. 按回车键后，命令会在后台执行
3. 输入以下命令，确认命令已执行：
   ```bash
   echo $?
   ```
   - 预期输出：`0` 表示命令执行成功

### 6.3 检查应用是否启动成功

**执行环境：服务器环境（虚拟环境已激活）**

1. 输入以下命令，查看应用进程：
   ```bash
   ps aux | grep gunicorn
   ```

2. 预期输出：应该能看到类似以下的进程信息
   ```
   root      1234  0.0  2.0 123456 7890 ?        Ss   10:00   0:00 /var/www/finance/venv/bin/python3 /var/www/finance/venv/bin/gunicorn --bind 0.0.0.0:5000 app:app
   root      1235  0.0  3.0 234567 8901 ?        S    10:00   0:00 /var/www/finance/venv/bin/python3 /var/www/finance/venv/bin/gunicorn --bind 0.0.0.0:5000 app:app
   ```

3. 输入以下命令，查看应用日志：
   ```bash
   tail -f finance.log
   ```

4. 预期输出：应该能看到类似以下的启动信息
   ```
   [2024-01-01 10:00:00 +0800] [1234] [INFO] Starting gunicorn 20.1.0
   [2024-01-01 10:00:00 +0800] [1234] [INFO] Listening at: http://0.0.0.0:5000 (1234)
   [2024-01-01 10:00:00 +0800] [1234] [INFO] Using worker: sync
   [2024-01-01 10:00:00 +0800] [1235] [INFO] Booting worker with pid: 1235
   ```

5. 按 `Ctrl+C` 键退出日志查看

---

## 配置防火墙

### 7.1 检查防火墙状态

**执行环境：服务器环境（虚拟环境已激活或未激活均可）**

1. 输入以下命令，查看防火墙状态：
   ```bash
   systemctl status firewalld
   ```

2. 预期输出：应该显示「active (running)」表示防火墙正在运行

### 7.2 开放必要端口

**执行环境：服务器环境**

1. 输入以下命令，开放22端口（SSH连接）：
   ```bash
   firewall-cmd --permanent --add-port=22/tcp
   ```

2. 输入以下命令，开放80端口（HTTP访问）：
   ```bash
   firewall-cmd --permanent --add-port=80/tcp
   ```

3. 输入以下命令，开放5000端口（应用访问）：
   ```bash
   firewall-cmd --permanent --add-port=5000/tcp
   ```

4. 每条命令执行后，预期输出：`success`

### 7.3 重新加载防火墙规则

**执行环境：服务器环境**

1. 输入以下命令，重新加载防火墙规则：
   ```bash
   firewall-cmd --reload
   ```

2. 预期输出：`success`

### 7.4 确认端口已开放

**执行环境：服务器环境**

1. 输入以下命令，查看已开放的端口：
   ```bash
   firewall-cmd --list-all
   ```

2. 预期输出：在「ports」部分应该能看到 `22/tcp 80/tcp 5000/tcp`

---

## 测试访问网站

### 8.1 在本地浏览器访问

**执行环境：本地计算机（浏览器）**

1. 打开您常用的浏览器（如Chrome、Edge、Firefox等）
2. 在地址栏中输入以下URL：
   ```
   http://8.138.228.54:5000
   ```
3. 按回车键访问
4. 预期结果：应该能看到应用的登录页面或首页

### 8.2 检查应用日志

**执行环境：服务器环境**

如果访问失败，可以查看应用日志了解问题：

1. 输入以下命令，查看最新的日志：
   ```bash
   tail -n 50 finance.log
   ```

2. 查看是否有错误信息，根据错误信息进行排查

---

## 常见问题解决方案

### 9.1 无法连接到服务器

**问题**：使用Workbench连接时提示「登录失败」

**解决方案**：
1. 确认输入的密码是否正确（区分大小写）
2. 检查是否在英文输入法下输入密码
3. 如果忘记密码，可以在阿里云控制台重置：
   - 进入ECS实例详情页
   - 点击「重置实例密码」
   - 设置新密码，点击「确认」
   - 等待1-2分钟后，使用新密码重新连接

### 9.2 无法上传文件

**问题**：使用控制台上传文件时提示失败

**解决方案**：
1. 检查文件大小是否超过限制（一般不超过1GB）
2. 尝试分批上传文件，不要一次上传太多
3. 尝试使用压缩包上传方法
4. 检查浏览器是否支持，推荐使用Chrome或Edge浏览器

### 9.3 依赖安装失败

**问题**：执行 `pip install -r requirements.txt` 时出现错误

**解决方案**：
1. 确认虚拟环境已激活（命令提示符前有 `(venv)`）
2. 尝试重新升级pip：`pip install --upgrade pip`
3. 检查网络连接是否正常
4. 如果某个依赖安装失败，可以单独安装：`pip install 依赖名称`

### 9.4 应用启动失败

**问题**：执行启动命令后，无法访问网站

**解决方案**：
1. 检查进程是否在运行：`ps aux | grep gunicorn`
2. 查看应用日志：`tail -f finance.log`
3. 检查配置文件是否正确：`cat app/config.py`
4. 确认端口是否被占用：`lsof -i:5000`

### 9.5 无法访问网站

**问题**：在浏览器中输入URL后无法连接

**解决方案**：
1. 检查服务器防火墙是否开放5000端口：`firewall-cmd --list-all`
2. 检查阿里云安全组是否开放5000端口
3. 检查应用是否正在运行：`ps aux | grep gunicorn`
4. 检查IP地址和端口是否输入正确

---

## 额外提示

1. **保持连接**：Workbench连接如果长时间不操作，可能会自动断开，需要重新连接
2. **命令输入**：在命令行中输入命令时，注意大小写和空格
3. **错误处理**：如果命令执行失败，会显示错误信息，可以根据错误信息进行排查
4. **备份重要文件**：在修改配置文件前，可以先备份：`cp app/config.py app/config.py.bak`
5. **重启应用**：如果修改了配置文件，需要重启应用才能生效

---

祝您部署成功！如果遇到问题，可以参考本指南的「常见问题解决方案」部分，或者联系阿里云技术支持。

